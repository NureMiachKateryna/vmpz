<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ß–∞—Ç –∑ JSON —Ç–∞ localStorage</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f7f9;
      display: flex;
      justify-content: center;
      padding-top: 40px;
    }

    #chat-container {
      background-color: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 20px 25px;
      width: 400px;
    }

    h2 {
      text-align: center;
      color: #333;
    }

    label {
      font-weight: bold;
    }

    select, input {
      padding: 8px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    select {
      width: 100%;
    }

    #messages {
      height: 200px;
      overflow-y: auto;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      margin: 10px 0;
      background-color: #fdfdfd;
    }

    .message {
      padding: 6px 8px;
      background-color: #e3f2fd;
      border-radius: 6px;
      margin-bottom: 6px;
      font-size: 14px;
    }

    #username, #message-input {
      width: 47%;
      margin-right: 3%;
    }

    #message-input {
      margin-right: 0;
    }

    button {
      margin-top: 10px;
      width: 100%;
      background-color: #2196f3;
      color: white;
      border: none;
      padding: 10px;
      font-size: 15px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #1976d2;
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <h2>üí¨ –°—Ç—É–¥–µ–Ω—Ç—Å—å–∫–∏–π —á–∞—Ç</h2>

    <label for="room-select">–û–±–µ—Ä—ñ—Ç—å –∫—ñ–º–Ω–∞—Ç—É:</label>
    <select id="room-select">
      <option value="–î–æ–ø–æ–º–æ–≥–∞ –∑ –î–ó">–î–æ–ø–æ–º–æ–≥–∞ –∑ –î–ó</option>
      <option value="–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –ø–∞—Ä">–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –ø–∞—Ä</option>
      <option value="–ö—É—Ä—Å–æ–≤—ñ —ñ –ø—Ä–æ—î–∫—Ç–∏">–ö—É—Ä—Å–æ–≤—ñ —ñ –ø—Ä–æ—î–∫—Ç–∏</option>
    </select>

    <div id="messages"></div>

    <input type="text" id="username" placeholder="–Ü–º‚Äô—è" />
    <input type="text" id="message-input" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." />
    <button onclick="sendMessage()">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
  </div>

  <script>
    const defaultRooms = {
      "–î–æ–ø–æ–º–æ–≥–∞ –∑ –î–ó": [],
      "–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –ø–∞—Ä": [],
      "–ö—É—Ä—Å–æ–≤—ñ —ñ –ø—Ä–æ—î–∫—Ç–∏": []
    };

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage –∞–±–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –∑–Ω–∞—á–µ–Ω—å
    let messagesByRoom = JSON.parse(localStorage.getItem("chatData")) || defaultRooms;

    const messageInput = document.getElementById("message-input");
    const messagesDiv = document.getElementById("messages");
    const roomSelect = document.getElementById("room-select");
    const usernameInput = document.getElementById("username");

    function renderMessages() {
      const room = roomSelect.value;
      messagesDiv.innerHTML = '';
      const roomMessages = messagesByRoom[room] || [];

      roomMessages.forEach(msg => {
        const div = document.createElement("div");
        div.className = "message";
        div.textContent = `${msg.user}: ${msg.text}`;
        messagesDiv.appendChild(div);
      });

      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function sendMessage() {
      const room = roomSelect.value;
      const text = messageInput.value.trim();
      const user = usernameInput.value.trim() || "–ê–Ω–æ–Ω—ñ–º";

      if (text !== "") {
        const message = { user, text };
        messagesByRoom[room].push(message);

        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–∏–π –æ–±'—î–∫—Ç —É localStorage —è–∫ JSON
        localStorage.setItem("chatData", JSON.stringify(messagesByRoom));

        messageInput.value = "";
        renderMessages();
      }
    }

    // –†–µ–Ω–¥–µ—Ä –ø—Ä–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—ñ –∫—ñ–º–Ω–∞—Ç–∏
    roomSelect.addEventListener("change", renderMessages);

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–µ–Ω–¥–µ—Ä –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    window.addEventListener("load", renderMessages);
  </script>
</body>
</html>
